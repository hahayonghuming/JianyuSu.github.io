---
title: 'Graph for Traffic'
date: 2020-12-25
permalink: /posts/2012/08/blog-post-1/
tags:
  - graph convolution
  - graph
  - traffic
  - machine learning
---

Arised from the flexibity of its data structure, graph is a useful tool to describe relations among entities and has been applied to domains such social science, biology etc. In contrast, graph has been seldomly utilized to depict micro-level traffic. In this post, we discuss the usage of graphs on micro-level traffic cases, coupled with recurrent neural network.  

Graph for Traffic
======
# Car-Following Models
Car-Following models is a family of models that predict the longitudinal behaviors (brake, accelerate) of the ego-vehicle (vehicle of our interests). Assuming the ego-vehicle reacts to its surrounding traffic, the literature often adopts interactions between the ego-vehicle and its surrounding vehicles as model inputs. The number of interactions considered in the model varies across the spectrum of studies.
# Graphs
Graph consists of edges and vertices, G=(E,V). **Graph is flexible and suitable to describe relations between entites as vertices can connect an arbitrary number of vetices.**Take social relations in facebook as an example, users might have different number of friends. It is easy to model relations of users using graph. In fact, we recommend friends based on metrics such as the distance between users (number of hops between two nodes etc.).

**In the context of driving, relations also matter. From a personal perspective, my driving behaviors are substantially affected by my surrounding vehicles.** For instance, if the vehicle in front of me brakes, I will slow down accordingly. If there is a truck driving next to me, I tend to accelerate to keep distance with the truck. In addition, if my sight is blocked by the front vehicle, I will be likely to maintain my speed and hesistate to switch lanes (I would love it if I can see 'through' the front vehicle or if the front vehicle can 'tell' me what is going on). Based on those personal experiences, I decided to model relations using graphs.

In the literature of car-following models, relations or interations among vehicles are well-defined. **Although the number of relations considered differs across the spectrum of research, they all demand inputs (relations) of fixed shape and spatial organization due to the fact that models take fixed-size inputs.** This yeilds a number of disadvantages:

- Micro-level traffic is very dynamic. It is hard to generalize models to different traffic scenes
- Some important interations are neglected because of the 'band-width' of the model (We cannot see through our front vehicles! Too bad!) 

**Graph helps! We can build a micro-level traffic graph to describe relations between vehicles.** We use an undirected graph G=(E,V) with N nodes v<sub>i</sub>\in V, edges (v<sub>i</sub>,v<sub>j</sub>)\in E, an adjacency matrix A \in \mathbb{R}<sup>NxN</sup>, a degree matrix with D<sub>ii</sub>=\sum<sub>j</sub> A<sub>ij</sub>, and a nodes feature information matrix X \in \mathbb{R}<sup>NxF</sup> to model the interactions between vehicles. As shown in the figure below, for a vehicle pair (v<sub>i</sub>,v<sub>j</sub>) where v<sub>i</sub>\in V and v<sub>j</sub> \in V, the edge (v<sub>i</sub>,v<sub>j</sub>) is connected if and only if:

- vehicle v<sub>j</sub> and v<sub>i</sub> appear at the same frame; and 
- vehicle v<sub>j</sub> is less than one lane away from vehicle v<sub>i</sub> at the current frame (vehicle v<sub>j</sub> should be on the same lane with vehicle v<sub>i</sub> or on vehicle i's left, right lanes); and 
- the absolute value difference of vehicle v<sub>j</sub>'s y-coordinate and vehicle v<sub>i</sub>'s y-coordinate is less than the designated value \tau at the current frame.

<table align="center">
  <tr>
     <td>
        <img src="/files/traffic.jpg" alt="traffic" width="400">
         <figcaption>Traffic</figcaption>
     </td>
     <td>
        <img src="/files/graph_configuration.jpg" alt="graph_configuration" width="400">
        <figcaption>Graph</figcaption>
     </td>
  </tr>
</table>

# Graph Convolution
Graph convolution is similar to convolution that we are familiar with, except that graph convolution operates on graphs. As we all know that convolution extract spatial information from images, graph convolution also extrac spatial information from graphs. In graphs, some nodes are connected while others might be n-hops away. Graph convolution aggregate neigbhoring nodes information for each node. **That is, after one graph convolution operation, the learned encoding for each node also contains its neighbor's information.**

**What happens if we apply two graph convolutions? The learned encoding contains information for nodes that are 2-hops away!**


# Experiments
## Training
## Testing
## External Reading
If you are interested in knowing more details about applying graphs to micro-level traffic modeling, please read [my paper](https://arxiv.org/abs/1911.09837) collorated with Toyota InfoTech Labs, Mountain View, CA.
